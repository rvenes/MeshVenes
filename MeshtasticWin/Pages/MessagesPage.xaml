<Page
    x:Class="MeshtasticWin.Pages.MessagesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MeshtasticWin.Pages">

	    <Grid Padding="12">
	        <Grid.ColumnDefinitions>
	            <ColumnDefinition Width="360"/>
	            <ColumnDefinition Width="12"/>
	            <ColumnDefinition Width="*"/>
	        </Grid.ColumnDefinitions>

	        <!-- VENSTRE: chat/nodeliste -->
	        <Grid Grid.Column="0" RowDefinitions="Auto,6,Auto,6,*">
	            <TextBlock Text="Chats" FontSize="22" FontWeight="SemiBold" />

	            <TextBox Grid.Row="2"
	                     x:Name="ChatSearchBox"
	                     PlaceholderText="Søk (namn / id)"
	                     TextChanged="ChatSearchBox_TextChanged"/>

	            <ListView Grid.Row="4"
	                      x:Name="ChatList"
	                      ItemsSource="{x:Bind ChatListItems, Mode=OneWay}"
	                      SelectionMode="Single"
	                      SelectionChanged="ChatList_SelectionChanged">
	                <ListView.ItemTemplate>
	                    <DataTemplate x:DataType="local:ChatListItemVm">
	                        <Grid Padding="10" RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
	                            <TextBlock Text="{x:Bind Title}" FontWeight="SemiBold" />
	                            <TextBlock Grid.Column="1" Text="{x:Bind ShortId}" Opacity="0.7"/>

	                            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Opacity="0.8">
	                                <TextBlock Text="{x:Bind LastHeard}" />
	                                <TextBlock Text="SNR:"/>
	                                <TextBlock Text="{x:Bind SNR}" />
	                                <TextBlock Text="RSSI:"/>
	                                <TextBlock Text="{x:Bind RSSI}" />
	                            </StackPanel>
	                        </Grid>
	                    </DataTemplate>
	                </ListView.ItemTemplate>
	            </ListView>
	        </Grid>

	        <!-- HØGRE: meldingar -->
	        <Grid Grid.Column="2" RowDefinitions="Auto,12,*,12,Auto">
	            <!-- Header -->
	            <TextBlock Text="{x:Bind ActiveChatTitle, Mode=OneWay}" FontSize="30" FontWeight="SemiBold" />

	            <!-- Messages -->
	            <ListView Grid.Row="2"
	                      x:Name="MessagesList"
	                      ItemsSource="{x:Bind ViewMessages, Mode=OneWay}">
	                <ListView.ItemTemplate>
	                    <DataTemplate x:DataType="local:MessageVm">
	                        <StackPanel Spacing="4" Padding="10">
	                            <StackPanel Orientation="Horizontal" Spacing="12">
	                                <TextBlock Text="{x:Bind Header}" FontWeight="SemiBold"/>
	                                <TextBlock Text="{x:Bind When}" Opacity="0.7"/>
	                            </StackPanel>

	                            <StackPanel Orientation="Horizontal" Spacing="6">
	                                <!-- ✓ (heard) -->
	                                <FontIcon Glyph="&#xE73E;"
	                                          Foreground="Green"
	                                          FontFamily="Segoe MDL2 Assets"
	                                          Visibility="{x:Bind HeardVisible}" />

	                                <!-- ✓✓ (delivered) -->
	                                <FontIcon Glyph="&#xE73E;"
	                                          Foreground="Green"
	                                          FontFamily="Segoe MDL2 Assets"
	                                          Visibility="{x:Bind DeliveredVisible}" />

	                                <TextBlock Text="{x:Bind Text}" TextWrapping="Wrap"/>
	                            </StackPanel>
	                        </StackPanel>
	                    </DataTemplate>
	                </ListView.ItemTemplate>
	            </ListView>

	            <!-- Composer -->
	            <Grid Grid.Row="4">
	                <Grid.ColumnDefinitions>
	                    <ColumnDefinition Width="*"/>
	                    <ColumnDefinition Width="12"/>
	                    <ColumnDefinition Width="160"/>
	                </Grid.ColumnDefinitions>

	                <TextBox x:Name="InputBox"
	                         PlaceholderText="Skriv melding..."
	                         AcceptsReturn="False"
	                         KeyDown="InputBox_KeyDown"/>

	                <Button Grid.Column="2"
	                        Content="Send"
	                        Click="Send_Click"/>
	            </Grid>
	        </Grid>
	    </Grid>
</Page>
